<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DAMCH - Faculty Leave Management System</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Poppins',sans-serif;background:#f0f2f5;color:#333;font-size:13px}
:root{--primary:#1a237e;--accent:#b71c1c;--green:#2e7d32;--card:#fff;--shadow:0 2px 12px rgba(0,0,0,.08)}
.login-page{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,#1a237e,#283593,#b71c1c);display:flex;justify-content:center;align-items:center;z-index:9999}
.login-card{background:#fff;border-radius:16px;padding:35px;width:400px;box-shadow:0 20px 60px rgba(0,0,0,.3);text-align:center}
.login-card .logo-circle{width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg,var(--primary),var(--accent));margin:0 auto 15px;display:flex;align-items:center;justify-content:center;color:#fff;font-size:28px;font-weight:800}
.login-card h2{color:var(--accent);font-size:16px;margin-bottom:3px}
.login-card h4{color:#555;font-size:11px;font-weight:500;margin-bottom:4px}
.login-card .subtitle{font-size:13px;font-weight:700;color:var(--primary);margin-bottom:18px;padding:6px;background:#e8eaf6;border-radius:8px}
.login-card input{width:100%;padding:11px 14px;margin-bottom:10px;border:1.5px solid #ddd;border-radius:8px;font-size:13px;font-family:'Poppins';transition:.3s}
.login-card input:focus{border-color:var(--primary);box-shadow:0 0 0 3px rgba(26,35,126,.1);outline:none}
.login-btn{width:100%;padding:12px;background:linear-gradient(135deg,var(--accent),#d32f2f);color:#fff;border:none;border-radius:8px;font-size:15px;font-weight:700;cursor:pointer;font-family:'Poppins';transition:.3s}
.login-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(183,28,28,.3)}
.show-pw{font-size:10px;color:var(--primary);cursor:pointer;text-align:right;display:block;margin:-6px 0 10px}
.login-msg{color:var(--accent);font-size:11px;font-weight:600;min-height:18px;margin-top:8px}
.login-footer{font-size:9px;color:#999;margin-top:15px;line-height:1.6}
.login-footer a{color:var(--primary)}
.login-footer .dev{color:var(--primary);font-weight:700;font-size:10px}
.app-container{display:flex;min-height:100vh}
.sidebar{width:240px;background:linear-gradient(180deg,#1a237e,#0d1547);color:#fff;position:fixed;top:0;left:0;height:100vh;overflow-y:auto;z-index:100;transition:.3s}
.sidebar .sb-header{padding:15px;text-align:center;border-bottom:1px solid rgba(255,255,255,.1)}
.sidebar .sb-header h3{font-size:11px;font-weight:600;margin-bottom:2px}
.sidebar .sb-header p{font-size:9px;opacity:.7}
.sb-menu{list-style:none;padding:10px 0}
.sb-menu li a{display:flex;align-items:center;padding:11px 20px;color:rgba(255,255,255,.8);text-decoration:none;font-size:12px;font-weight:500;transition:.2s;gap:12px;border-left:3px solid transparent}
.sb-menu li a:hover,.sb-menu li a.active{background:rgba(255,255,255,.1);color:#fff;border-left-color:#ff5252}
.sb-menu li a i{width:20px;text-align:center;font-size:14px}
.main-content{margin-left:240px;padding:15px;min-height:100vh;transition:.3s}
.topbar{background:var(--card);padding:10px 20px;border-radius:12px;display:flex;justify-content:space-between;align-items:center;box-shadow:var(--shadow);margin-bottom:15px;flex-wrap:wrap;gap:8px}
.topbar .left h2{font-size:16px;color:var(--primary)}
.topbar .left p{font-size:11px;color:#888}
.topbar .right{display:flex;align-items:center;gap:12px}
.topbar .right .user-badge{background:#e8eaf6;padding:6px 14px;border-radius:20px;font-size:11px;font-weight:600;color:var(--primary)}
.topbar .right .btn-logout{background:var(--accent);color:#fff;border:none;padding:7px 16px;border-radius:8px;font-size:11px;cursor:pointer;font-family:'Poppins';font-weight:600}
.stats-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-bottom:15px}
.stat-card{background:var(--card);border-radius:12px;padding:16px;box-shadow:var(--shadow);display:flex;align-items:center;gap:14px;transition:.3s;cursor:pointer}
.stat-card:hover{transform:translateY(-3px);box-shadow:0 6px 20px rgba(0,0,0,.12)}
.stat-card .icon{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:20px;color:#fff}
.stat-card .info h3{font-size:22px;font-weight:800;line-height:1}
.stat-card .info p{font-size:10px;color:#888;font-weight:500}
.charts-row{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:15px}
.chart-card{background:var(--card);border-radius:12px;padding:18px;box-shadow:var(--shadow)}
.chart-card h4{font-size:13px;font-weight:700;color:var(--primary);margin-bottom:10px;padding-bottom:6px;border-bottom:2px solid #e8eaf6}
.data-card{background:var(--card);border-radius:12px;padding:18px;box-shadow:var(--shadow);margin-bottom:15px}
.data-card h4{font-size:14px;font-weight:700;color:var(--primary);margin-bottom:12px}
.data-table{width:100%;border-collapse:collapse}
.data-table th{background:var(--primary);color:#fff;padding:10px 8px;font-size:11px;font-weight:600;text-transform:uppercase;text-align:left}
.data-table td{padding:9px 8px;border-bottom:1px solid #eee;font-size:11px}
.data-table tr:hover{background:#f5f5f5}
.badge{padding:3px 10px;border-radius:12px;font-size:10px;font-weight:600;display:inline-block}
.badge-pending{background:#fff3e0;color:#e65100}
.badge-approved{background:#e8f5e9;color:#2e7d32}
.badge-rejected{background:#ffebee;color:#c62828}
.badge-principal{background:#e8eaf6;color:#1a237e}
.badge-professor{background:#e0f2f1;color:#00695c}
.badge-assoc{background:#fff8e1;color:#f57f17}
.badge-asst{background:#fce4ec;color:#880e4f}
.page-section{display:none}
.page-section.active{display:block}
.btn{padding:7px 16px;border:none;border-radius:8px;font-size:11px;font-weight:600;cursor:pointer;font-family:'Poppins';transition:.2s;display:inline-flex;align-items:center;gap:6px}
.btn:hover{transform:translateY(-1px)}
.btn-primary{background:var(--primary);color:#fff}
.btn-success{background:var(--green);color:#fff}
.btn-danger{background:var(--accent);color:#fff}
.btn-warning{background:#f57f17;color:#fff}
.btn-info{background:#0277bd;color:#fff}
.btn-sm{padding:5px 10px;font-size:10px}
.form-group{margin-bottom:12px}
.form-group label{display:block;font-size:11px;font-weight:600;color:#555;margin-bottom:4px}
.form-group input,.form-group select,.form-group textarea{width:100%;padding:9px 12px;border:1.5px solid #ddd;border-radius:8px;font-size:12px;font-family:'Poppins';transition:.3s}
.form-group input:focus,.form-group select:focus{border-color:var(--primary);box-shadow:0 0 0 3px rgba(26,35,126,.08);outline:none}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.date-group{display:flex;gap:4px;align-items:center}
.date-group input{width:48px;text-align:center;padding:9px 4px}
.date-group input.yy{width:68px}
.date-group span{color:#999;font-weight:700}
.leave-table{width:100%;border-collapse:collapse;font-size:10px}
.leave-table th,.leave-table td{border:1px solid #ccc;padding:4px 3px;text-align:center}
.leave-table thead th{background:var(--primary);color:#fff;font-size:9px;position:sticky;top:0;z-index:5}
.leave-table .sub-head th{background:#37474f;color:#fff;font-size:8px}
.leave-table .grp-paid{background:#1b5e20;color:#fff}
.leave-table .grp-unpaid{background:#b71c1c;color:#fff}
.leave-table input[type=number]{width:36px;text-align:center;border:1px solid #999;font-size:11px;font-weight:700;padding:2px;font-family:'Poppins'}
.leave-table .bal{background:#e0e0e0;font-weight:800}
.leave-table .bal-neg{background:#ffcdd2;color:#b71c1c;font-weight:800}
.leave-table .tot-paid{background:#a5d6a7;font-weight:900;font-size:12px;border:2px solid #1b5e20!important}
.leave-table .tot-unpaid{background:#ef9a9a;font-weight:900;font-size:12px;border:2px solid #b71c1c!important}
.leave-table .grand{background:#fff176;font-weight:900;font-size:13px;border:2px solid #f57f17!important}
.leave-table .name-cell{text-align:left;padding-left:5px;min-width:220px;position:sticky;left:0;background:#fff;z-index:4;border-right:2px solid #333}
.leave-table thead th:first-child{position:sticky;left:0;z-index:7;background:#1a237e}
.leave-table .exp-tag{font-size:9px;color:#0d47a1;background:#e3f2fd;padding:1px 4px;border-radius:3px;display:inline-block;margin-top:2px}
.leave-table .admin-input{width:95%;border:1px solid #ccc;padding:2px 4px;border-radius:4px;font-family:'Poppins';margin-bottom:2px}
.app-footer{text-align:center;padding:12px;font-size:10px;color:#888;border-top:1px solid #e0e0e0;margin-top:20px}
.app-footer b{color:var(--primary)}
@media(max-width:768px){.sidebar{width:60px}.sidebar .sb-header h3,.sidebar .sb-header p,.sb-menu li a span{display:none}.main-content{margin-left:60px}.charts-row,.form-row{grid-template-columns:1fr}.stats-row{grid-template-columns:repeat(2,1fr)}}
@media print{.sidebar,.topbar,.app-footer,.no-print{display:none!important}.main-content{margin-left:0!important;padding:5px!important}.page-section{display:block!important}.data-card,.chart-card{box-shadow:none!important;break-inside:avoid}}
</style>
</head>
<body>
<div class="login-page" id="loginPage">
<div class="login-card">
<div class="logo-circle">D</div>
<h2>Dhanwantari Ayurved Medical College & Hospital</h2>
<h4>Tq. Udgir, Dist. Latur, Maharashtra</h4>
<div class="subtitle"><i class="fas fa-book-open"></i> Faculty Leave Management System</div>
<input type="text" id="loginUser" placeholder="Username (Teacher Code / admin)" autocomplete="off">
<input type="password" id="loginPass" placeholder="Password">
<span class="show-pw" onclick="togglePw()"><i class="fas fa-eye"></i> Show Password</span>
<button class="login-btn" onclick="doLogin()"><i class="fas fa-sign-in-alt"></i> LOGIN</button>
<div class="login-msg" id="loginMsg"></div>
<div class="login-footer">
<i class="fas fa-phone"></i> (02385) 259825 | <i class="fas fa-envelope"></i> contact@damchudgir.edu.in<br>
<a href="http://www.damchudgir.edu.in" target="_blank"><i class="fas fa-globe"></i> www.damchudgir.edu.in</a><br><br>
<span class="dev"><i class="fas fa-code"></i> Designed & Developed by Dr. Jadhav V.R.</span>
</div>
</div>
</div>
<div class="app-container" id="appContainer" style="display:none">
<div class="sidebar" id="sidebar">
<div class="sb-header">
<div style="width:50px;height:50px;border-radius:50%;background:linear-gradient(135deg,#ff5252,#ff1744);display:flex;align-items:center;justify-content:center;color:#fff;font-size:20px;font-weight:800;margin:0 auto 5px">D</div>
<h3>DAMCH Udgir</h3>
<p id="sbUserName">Admin</p>
</div>
<ul class="sb-menu">
<li><a href="#" class="active" onclick="showPage('dashboard',this)"><i class="fas fa-chart-pie"></i><span>Dashboard</span></a></li>
<li><a href="#" onclick="showPage('leaveRecord',this)"><i class="fas fa-table"></i><span>Leave Record</span></a></li>
<li><a href="#" onclick="showPage('applyLeave',this)"><i class="fas fa-paper-plane"></i><span>Apply Leave</span></a></li>
<li><a href="#" onclick="showPage('applications',this)"><i class="fas fa-inbox"></i><span>Applications</span></a></li>
<li><a href="#" onclick="showPage('faculty',this)"><i class="fas fa-users"></i><span>Faculty List</span></a></li>
<li><a href="#" onclick="showPage('profile',this)"><i class="fas fa-user-cog"></i><span>My Profile</span></a></li>
<li><a href="#" onclick="showPage('reports',this)"><i class="fas fa-file-alt"></i><span>Reports</span></a></li>
<li><a href="#" onclick="showPage('settings',this)"><i class="fas fa-cog"></i><span>Settings</span></a></li>
<li><a href="#" onclick="doLogout()"><i class="fas fa-sign-out-alt"></i><span>Logout</span></a></li>
</ul>
</div>
<div class="main-content">
<div class="topbar">
<div class="left"><h2 id="pageTitle"><i class="fas fa-chart-pie"></i> Dashboard</h2><p id="pageSubtitle">Overview & Statistics</p></div>
<div class="right">
<span class="user-badge" id="topUserBadge"><i class="fas fa-user"></i> Admin</span>
<input type="date" id="reportDate" style="padding:5px 8px;border:1.5px solid #ddd;border-radius:8px;font-size:11px;font-family:'Poppins'">
<button class="btn-logout" onclick="doLogout()"><i class="fas fa-power-off"></i> Logout</button>
</div>
</div>

<!-- DASHBOARD -->
<div class="page-section active" id="pg_dashboard">
<div class="stats-row" id="statsRow"></div>
<div class="charts-row">
<div class="chart-card"><h4><i class="fas fa-building"></i> Faculty by Department</h4><canvas id="chartDept" height="220"></canvas></div>
<div class="chart-card"><h4><i class="fas fa-graduation-cap"></i> Faculty by Designation</h4><canvas id="chartDesig" height="220"></canvas></div>
</div>
<div class="charts-row">
<div class="chart-card"><h4><i class="fas fa-check-circle"></i> Application Status</h4><canvas id="chartStatus" height="220"></canvas></div>
<div class="chart-card"><h4><i class="fas fa-calendar-alt"></i> Monthly Leave Trend</h4><canvas id="chartTrend" height="220"></canvas></div>
</div>
<div class="data-card"><h4><i class="fas fa-clock"></i> Recent Applications</h4><div style="overflow-x:auto"><table class="data-table" id="recentAppsTable"><thead><tr><th>Date</th><th>Faculty</th><th>Type</th><th>From</th><th>To</th><th>Days</th><th>Status</th></tr></thead><tbody></tbody></table></div></div>
</div>
<!-- LEAVE RECORD -->
<div class="page-section" id="pg_leaveRecord">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;flex-wrap:wrap;gap:8px">
<div>
<button class="btn btn-primary" id="btnYr25" onclick="swYear('2025')"><i class="fas fa-calendar"></i> 2025</button>
<button class="btn" style="background:#555;color:#fff" id="btnYr26" onclick="swYear('2026')"><i class="fas fa-calendar"></i> 2026</button>
</div>
<div id="adminLeaveCtrl">
<button class="btn btn-success" onclick="addRow()"><i class="fas fa-plus"></i> Add Faculty</button>
<button class="btn btn-warning" onclick="calcCarryFwd()"><i class="fas fa-calculator"></i> EL Carry 2025â†’2026</button>
<button class="btn btn-info" onclick="searchFac()"><i class="fas fa-search"></i> Search</button>
</div>
</div>
<div class="data-card" style="padding:8px">
<h4 id="lrTitle" style="text-align:center;margin-bottom:8px">Leave Record: 2025</h4>
<div style="overflow-x:auto;max-height:75vh">
<table class="leave-table" id="leaveTable">
<thead>
<tr>
<th rowspan="3" style="width:30px;position:sticky;left:0;z-index:7;background:#1a237e">Sr</th>
<th rowspan="3" class="name-cell" style="background:#1a237e;color:#fff;z-index:7;min-width:220px">Faculty & Experience</th>
<th colspan="23" class="grp-paid">PAID LEAVE</th>
<th colspan="2" class="grp-unpaid">UNPAID</th>
<th rowspan="3" style="background:#212121;color:#fff">GRAND<br>TOTAL</th>
<th rowspan="3" style="background:#333;color:#fff" id="actColH">ACT</th>
</tr>
<tr>
<th colspan="2" style="background:#2e7d32;color:#fff">CL(8)</th>
<th colspan="2" style="background:#2e7d32;color:#fff">ML(10)</th>
<th style="background:#2e7d32;color:#fff">OD</th>
<th colspan="5" style="background:#1565c0;color:#fff">EL(Earned)</th>
<th colspan="2" style="background:#000;color:#fff">Late(1/6)</th>
<th colspan="2" style="background:#2e7d32;color:#fff">Mat(180)</th>
<th colspan="2" style="background:#004d40;color:#fff">Pat(15)</th>
<th colspan="2" style="background:#2e7d32;color:#fff">SL(15)</th>
<th colspan="2" style="background:#2e7d32;color:#fff">SD(120)</th>
<th colspan="2" style="background:#2e7d32;color:#fff">RH(2)</th>
<th style="background:#212121;color:#fff">PAID<br>TOT</th>
<th style="background:#8e0000;color:#fff">LWP</th>
<th style="background:#b71c1c;color:#fff">UNPD<br>TOT</th>
</tr>
<tr class="sub-head"><th>U</th><th>B</th><th>U</th><th>B</th><th>U</th><th>Op</th><th>Nw</th><th>Tt</th><th>U</th><th>B</th><th>Cn</th><th>Dd</th><th>U</th><th>B</th><th>U</th><th>B</th><th>U</th><th>B</th><th>U</th><th>B</th><th>U</th><th>B</th><th>U</th></tr>
</thead>
<tbody id="lrBody"></tbody>
</table>
</div></div>
<div style="text-align:right;margin-top:8px" id="adminSaveArea">
<button class="btn btn-info" onclick="saveAll()"><i class="fas fa-save"></i> Save</button>
<button class="btn" style="background:#5e35b1;color:#fff" onclick="downloadJSON()"><i class="fas fa-download"></i> JSON</button>
<button class="btn btn-success" onclick="expCSV()"><i class="fas fa-file-excel"></i> Excel</button>
<input type="file" id="restFile" style="display:none" accept=".json" onchange="restoreJSON(event)">
<button class="btn" style="background:#6a1b9a;color:#fff" onclick="document.getElementById('restFile').click()"><i class="fas fa-upload"></i> Restore</button>
</div></div>

<!-- APPLY LEAVE -->
<div class="page-section" id="pg_applyLeave">
<div class="data-card" style="max-width:600px;margin:0 auto">
<h4><i class="fas fa-paper-plane"></i> Apply for Leave</h4>
<div class="form-row">
<div class="form-group"><label>Leave Type</label><select id="appType"><option value="CL">Casual Leave (CL)</option><option value="ML">Medical Leave (ML)</option><option value="EL">Earned Leave (EL)</option><option value="OD">On Duty (OD)</option><option value="Mat">Maternity Leave</option><option value="Pat">Paternity Leave</option><option value="SL">Special Leave</option><option value="RH">Restricted Holiday</option><option value="LWP">Leave Without Pay</option></select></div>
<div class="form-group"><label>Total Days</label><input type="number" id="appDays" min="1" value="1"></div>
</div>
<div class="form-row">
<div class="form-group"><label>From Date</label><input type="date" id="appFrom"></div>
<div class="form-group"><label>To Date</label><input type="date" id="appTo"></div>
</div>
<div class="form-group"><label>Reason</label><textarea id="appReason" rows="3" style="width:100%;padding:9px 12px;border:1.5px solid #ddd;border-radius:8px;font-size:12px;font-family:'Poppins'"></textarea></div>
<button class="btn btn-success" onclick="submitApp()" style="width:100%;padding:12px;font-size:14px"><i class="fas fa-paper-plane"></i> Submit Application</button>
</div>
<div class="data-card" style="margin-top:15px"><h4><i class="fas fa-history"></i> My Applications</h4><div style="overflow-x:auto"><table class="data-table" id="myAppsTable"><thead><tr><th>Date</th><th>Type</th><th>From</th><th>To</th><th>Days</th><th>Reason</th><th>Status</th></tr></thead><tbody></tbody></table></div></div>
</div>

<!-- APPLICATIONS (Admin) -->
<div class="page-section" id="pg_applications">
<div class="data-card">
<h4><i class="fas fa-inbox"></i> All Leave Applications <span class="badge badge-pending" id="pendCnt" style="font-size:12px;margin-left:8px"></span></h4>
<div style="margin-bottom:10px">
<button class="btn btn-sm btn-warning" onclick="filterApps('all')">All</button>
<button class="btn btn-sm" style="background:#ff9800;color:#fff" onclick="filterApps('Pending')">Pending</button>
<button class="btn btn-sm btn-success" onclick="filterApps('Approved')">Approved</button>
<button class="btn btn-sm btn-danger" onclick="filterApps('Rejected')">Rejected</button>
</div>
<div style="overflow-x:auto"><table class="data-table" id="allAppsTable"><thead><tr><th>Date</th><th>Faculty</th><th>Code</th><th>Dept</th><th>Type</th><th>From</th><th>To</th><th>Days</th><th>Reason</th><th>Status</th><th>Action</th></tr></thead><tbody></tbody></table></div>
</div></div>
<!-- FACULTY LIST -->
<div class="page-section" id="pg_faculty">
<div class="data-card"><h4><i class="fas fa-users"></i> Faculty Directory</h4>
<input type="text" id="facSrch" placeholder="Search name, code, department..." style="width:100%;padding:9px 14px;border:1.5px solid #ddd;border-radius:8px;margin-bottom:12px;font-family:'Poppins';font-size:12px" oninput="renderFacList()">
<div style="overflow-x:auto"><table class="data-table" id="facTable"><thead><tr><th>Sr</th><th>Name</th><th>Designation</th><th>Department</th><th>Code</th><th>DOJ</th><th>Exp</th></tr></thead><tbody></tbody></table></div></div></div>

<!-- PROFILE -->
<div class="page-section" id="pg_profile">
<div class="data-card" style="max-width:600px;margin:0 auto">
<h4><i class="fas fa-user-cog"></i> My Profile</h4>
<div class="form-row">
<div class="form-group"><label>Name</label><input type="text" id="pName" readonly style="background:#f5f5f5"></div>
<div class="form-group"><label>Teacher Code</label><input type="text" id="pCode" readonly style="background:#f5f5f5"></div>
</div>
<div class="form-row">
<div class="form-group"><label>Designation</label><input type="text" id="pDesig" readonly style="background:#f5f5f5"></div>
<div class="form-group"><label>Department</label><input type="text" id="pDept" readonly style="background:#f5f5f5"></div>
</div>
<div class="form-row">
<div class="form-group"><label>Date of Joining (DD/MM/YYYY)</label><div class="date-group"><input type="text" id="pDojD" maxlength="2" placeholder="DD" oninput="autoTab(this,'pDojM')"><span>/</span><input type="text" id="pDojM" maxlength="2" placeholder="MM" oninput="autoTab(this,'pDojY')"><span>/</span><input type="text" id="pDojY" class="yy" maxlength="4" placeholder="YYYY"></div></div>
<div class="form-group"><label>Date of Birth (DD/MM/YYYY)</label><div class="date-group"><input type="text" id="pDobD" maxlength="2" placeholder="DD" oninput="autoTab(this,'pDobM')"><span>/</span><input type="text" id="pDobM" maxlength="2" placeholder="MM" oninput="autoTab(this,'pDobY')"><span>/</span><input type="text" id="pDobY" class="yy" maxlength="4" placeholder="YYYY"></div></div>
</div>
<div class="form-group"><label>New Password (leave blank to keep current)</label><input type="password" id="pNewPw" placeholder="Enter new password"></div>
<button class="btn btn-success" onclick="saveProf()" style="width:100%;padding:11px;font-size:13px;margin-top:8px"><i class="fas fa-save"></i> Save Profile</button>
</div></div>

<!-- REPORTS -->
<div class="page-section" id="pg_reports">
<div class="stats-row">
<div class="stat-card" onclick="rptAllDetail()"><div class="icon" style="background:linear-gradient(135deg,#1a237e,#3949ab)"><i class="fas fa-file-alt"></i></div><div class="info"><h3 style="font-size:14px">All Faculty</h3><p>Detailed Report</p></div></div>
<div class="stat-card" onclick="rptMaster(null)"><div class="icon" style="background:linear-gradient(135deg,#e65100,#ff6d00)"><i class="fas fa-list"></i></div><div class="info"><h3 style="font-size:14px">Master Summary</h3><p>All Departments</p></div></div>
<div class="stat-card" onclick="rptDeptDetail()"><div class="icon" style="background:linear-gradient(135deg,#00838f,#00acc1)"><i class="fas fa-building"></i></div><div class="info"><h3 style="font-size:14px">Dept Detailed</h3><p>Select Department</p></div></div>
<div class="stat-card" onclick="rptDeptSummary()"><div class="icon" style="background:linear-gradient(135deg,#f57f17,#ffb300)"><i class="fas fa-chart-bar"></i></div><div class="info"><h3 style="font-size:14px">Dept Summary</h3><p>Select Department</p></div></div>
</div></div>

<!-- SETTINGS -->
<div class="page-section" id="pg_settings">
<div class="data-card" style="max-width:650px;margin:0 auto">
<h4><i class="fas fa-cog"></i> Settings</h4>
<div class="form-group"><label>Upload Logo</label><input type="file" accept="image/*" onchange="upLogo(event)"></div>

<hr style="margin:15px 0">
<h4 style="margin-bottom:10px"><i class="fas fa-user-shield"></i> Change Faculty Password</h4>
<div class="form-row">
<div class="form-group"><label>Select Faculty / Admin</label><select id="mngSel" onchange="loadCred()"><option value="">-- Select --</option></select></div>
<div class="form-group"><label>Current Username</label><input type="text" id="mngUser" readonly style="background:#f5f5f5"></div>
</div>
<div class="form-row">
<div class="form-group"><label>Current Password</label><input type="text" id="mngCurPw" readonly style="background:#f0f0f0;color:#b71c1c;font-weight:700"></div>
<div class="form-group"><label>New Password</label><input type="text" id="mngNewPw" placeholder="Enter new password"></div>
</div>
<button class="btn btn-success" onclick="saveCred()" style="margin-top:5px"><i class="fas fa-save"></i> Update Password</button>
<div id="mngMsg" style="font-size:11px;color:green;font-weight:600;margin-top:8px"></div>

<hr style="margin:15px 0">
<h4 style="margin-bottom:10px"><i class="fas fa-database"></i> Data Management</h4>
<div style="display:flex;gap:8px;flex-wrap:wrap">
<button class="btn btn-info" onclick="saveAll()"><i class="fas fa-save"></i> Save</button>
<button class="btn" style="background:#5e35b1;color:#fff" onclick="downloadJSON()"><i class="fas fa-download"></i> Backup</button>
<input type="file" id="restFile2" style="display:none" accept=".json" onchange="restoreJSON(event)">
<button class="btn" style="background:#6a1b9a;color:#fff" onclick="document.getElementById('restFile2').click()"><i class="fas fa-upload"></i> Restore</button>
<button class="btn btn-danger" onclick="resetAll()"><i class="fas fa-trash"></i> Reset</button>
</div>
</div></div>

<div class="app-footer"><b>Designed & Developed by Dr. Jadhav V.R.</b> | Contact: 9518356305 | &copy; 2025 DAMCH Udgir</div>
</div></div>
<div id="printArea" style="display:none"></div>
<datalist id="desigList"><option value="Principal"><option value="Professor"><option value="Associate Professor"><option value="Assistant Professor"></datalist>
<script>
var curYr='2025',data=[],users={},apps=[],CU=null,cDept=null,cDesig=null,cStat=null,cTrend=null,appFlt='all';
var DR={"PRINCIPAL":1,"PROFESSOR":2,"ASSOCIATE PROFESSOR":3,"READER":3,"ASSISTANT PROFESSOR":4,"LECTURER":4};
var DD=[
{"id":1767934321233,"name":"Dr.Patil Dattatraya Vinayakrao","desig":"Principal","dept":"Sanskrit Samhita Siddhant","code":"AYSS00481","doj":"2003-12-23","dob":"1977-05-05","leaves_2025":{"cl":"7","od":"15","lat":"48","ml":"0","el_open":"0"},"leaves_2026":{"el_open":15}},
{"id":1767955726188,"name":"Dr.Shrigire Sayaram Ramgonda","desig":"Professor","dept":"Dravayaguna Vidnyan","code":"AYDG00564","doj":"2003-01-18","dob":"1969-01-01","leaves_2025":{"cl":"8","ml":"2","od":"7","lat":"84"},"leaves_2026":{"el_open":11}},
{"id":1767958577405,"name":"Dr.Kattewar Balaji Devrao","desig":"Professor","dept":"RSBK","code":"AYBK","doj":"2003-07-01","dob":"1973-09-11","leaves_2025":{"cl":"8","od":"1","el_u":"2","lat":"12"},"leaves_2026":{"el_open":13}},
{"id":1767955330141,"name":"Dr. Mundhe Mangesh Gopinath","desig":"Professor","dept":"PTSR","code":"AYPS00366","doj":"2005-03-04","dob":"1975-07-23","leaves_2025":{"cl":"8","od":"10","lat":"180"},"leaves_2026":{"el_open":0}},
{"id":1768206052606,"name":"Pushpa Dagdu Gawale","desig":"Professor","dept":"Kayachikitsa","code":"AYKC0","doj":"2008-10-20","dob":"","leaves_2025":{"cl":"8","ml":"10","lwp":"4","od":"0","sl":"5","el_u":"15","lat":"138","sd":"0","rh":"0","pat":"0","mat":"0"},"leaves_2026":{}},
{"id":1767961042431,"name":"Dr.Amol Umakant Patane","desig":"Professor","dept":"Panchakarma","code":"AYPK00687","doj":"2012-12-22","dob":"1982-12-17","leaves_2025":{"cl":"8","ml":"1","od":"5","el_u":"3","lat":"164"},"leaves_2026":{"el_open":0}},
{"id":1768021186994,"name":"Dr.Bansode Namdev Manohar","desig":"Professor","dept":"Rognidan evum VV","code":"AYRN0325","doj":"2014-09-01","dob":"","leaves_2025":{"cl":"8","ml":"1","od":"4","el_u":"6","lat":"138"},"leaves_2026":{"el_open":15}},
{"id":1768278195240,"name":"Dr.Ravikant Vinayakrao Patil","desig":"Professor","dept":"Shalakyatantra","code":"AYSK0659","doj":"2018-12-27","dob":"","leaves_2025":{"cl":"7","ml":"0","od":"6","el_u":"6","lat":"176"},"leaves_2026":{}},
{"id":1768021174955,"name":"Dr.Mundhe Vishnukant Dnyanoba","desig":"Professor","dept":"","code":"","doj":"","dob":"","leaves_2025":{},"leaves_2026":{"el_open":15}},
{"id":1767959422862,"name":"Dr.Sachinkumar Vishwanath Tale","desig":"Associate Professor","dept":"Swasthavritta","code":"AYSV00250","doj":"2018-01-01","dob":"1990-06-24","leaves_2025":{"cl":"8","ml":"5","od":"4","el_u":"7","lat":"116"},"leaves_2026":{"el_open":0}},
{"id":1768201062768,"name":"Rashmi Yogiraj Chidre","desig":"Associate Professor","dept":"PTSR","code":"AYPS00416","doj":"2018-01-09","dob":"","leaves_2025":{"cl":"8","ml":"10","od":"1","el_u":"15","lat":"157","lwp":"21"},"leaves_2026":{}},
{"id":1768021173715,"name":"Dr.Mayuri Udaysingh Thakur","desig":"Associate Professor","dept":"Rachana Sharir","code":"AYRS00376","doj":"2018-07-02","dob":"","leaves_2025":{"cl":"8","ml":"10","od":"1","lat":"91","el_u":"0","mat":"56"},"leaves_2026":{"el_open":15}},
{"id":1767959835263,"name":"Dr.Jagtap Prajakta Sudhakar","desig":"Associate Professor","dept":"Panchakarma","code":"AYPK00359","doj":"2019-02-15","dob":"1991-08-18","leaves_2025":{"cl":"8","ml":"4","el_u":"5","lat":"159"},"leaves_2026":{"el_open":0}},
{"id":1767957913565,"name":"Dr.Snehal Gunderao Patil","desig":"Associate Professor","dept":"Kayachikitsa","code":"AYKC01011","doj":"2019-02-22","dob":"1986-04-04","leaves_2025":{"cl":"6","ml":"1","el_u":"1","lat":"117","od":"0"},"leaves_2026":{"el_open":8}},
{"id":1767961462063,"name":"Dr.Surnar Yogeshwar Namdev","desig":"Associate Professor","dept":"Shalyatantra","code":"AYUST1442","doj":"2019-03-01","dob":"1989-11-25","leaves_2025":{"cl":"8","ml":"6","od":"1","el_u":"6","lat":"96"},"leaves_2026":{"el_open":0}},
{"id":1768021176843,"name":"Dr.Deepika Chandrakant Bhadre","desig":"Associate Professor","dept":"PTSR","code":"AYPS01057","doj":"2020-02-17","dob":"","leaves_2025":{"cl":"8","ml":"8","sl":"3","lat":"190"},"leaves_2026":{"el_open":15}},
{"id":1767960762214,"name":"Dr.Ghorband Shital Dattatray","desig":"Associate Professor","dept":"Dravayaguna Vidnyan","code":"AYDG","doj":"2020-03-13","dob":"1981-02-23","leaves_2025":{"cl":"8","ml":"10","od":"9","el_u":"15","lat":"146"},"leaves_2026":{"el_open":0}},
{"id":1768021168209,"name":"Dr.Prashant Tryambakrao Biradar","desig":"Assistant Professor","dept":"Sanskrit Samhita Siddhant","code":"AYSN00048","doj":"2012-02-06","dob":"","leaves_2025":{"lat":"102","cl":"8","ml":"2","od":"10","el_u":"5"},"leaves_2026":{}},
{"id":1768021176627,"name":"Dr.Asmita Ashokrao Bhadre","desig":"Assistant Professor","dept":"Kaumarbhritya","code":"AYKB00709","doj":"2021-01-02","dob":"","leaves_2025":{"cl":"8","ml":"1","el_u":"4","lat":"171"},"leaves_2026":{"el_open":15}},
{"id":1767958840101,"name":"Dr.Martule Shivkumar Surykant","desig":"Assistant Professor","dept":"Kaumarbhritya","code":"AYKB00725","doj":"2021-03-25","dob":"1994-01-01","leaves_2025":{"lat":"141","cl":"8","od":"2","el_u":"3"},"leaves_2026":{"el_open":"0"}},
{"id":1768203668172,"name":"Namrata Virnath Kore","desig":"Assistant Professor","dept":"Rognidan and Vikruti Vigyan","code":"AYRN00765","doj":"2021-03-26","dob":"","leaves_2025":{"lat":"248","ml":"10","lwp":"13","cl":"8","od":"3","el_u":"7"},"leaves_2026":{}},
{"id":1,"name":"Dr. Jadhav Vishnukant Rameshrao","desig":"Assistant Professor","dept":"Rachana Sharir","code":"AYRS01211","doj":"2022-04-01","dob":"1994-02-13","leaves_2025":{"lat":"116","cl":"8","ml":"0","el_u":"0"},"leaves_2026":{"el_open":8}},
{"id":1768021164259,"name":"Dr.Pravin Dattatraya Balutkar","desig":"Assistant Professor","dept":"RSBK","code":"AYRB01770","doj":"2022-04-01","dob":"1985-02-02","leaves_2025":{"cl":"8","ml":"10","od":"2","el_u":"11","lat":"124"},"leaves_2026":{"el_open":0}},
{"id":1767960145014,"name":"Dr.Soppa Madhumati Shrikant","desig":"Assistant Professor","dept":"Kriya Sharir","code":"AYKS01029","doj":"2022-06-20","dob":"1989-10-10","leaves_2025":{"cl":"6","ml":"8","od":"3","lat":"153"},"leaves_2026":{"el_open":0}},
{"id":1768021168426,"name":"Dr.Amol Shivajirao Patil","desig":"Assistant Professor","dept":"Shalya tantra","code":"AYST02412","doj":"2024-01-19","dob":"","leaves_2025":{"cl":"8","ml":"6","od":"0","el_u":"5","lat":"148","pat":"5"},"leaves_2026":{"el_open":"0"}},
{"id":1767957277181,"name":"Dr.Shruti Rameshchandra Tiwari","desig":"Assistant Professor","dept":"Panchakarma","code":"AYPK94915","doj":"2024-06-01","dob":"1986-08-18","leaves_2025":{"cl":"8","ml":"8","el_u":"2","lat":"118"},"leaves_2026":{"el_open":0}},
{"id":1767958307517,"name":"Dr.Meera Shankarrao Kadam","desig":"Assistant Professor","dept":"Agadtantra evum VV","code":"AYAT00650","doj":"2024-08-04","dob":"1991-05-03","leaves_2025":{"cl":"8","ml":"4","el_u":"7","lat":"130"},"leaves_2026":{"el_open":0}},
{"id":1767961700895,"name":"Dr.Shivpratap Vinayak Biradar","desig":"Assistant Professor","dept":"Kaumarbhritya","code":"AYKB01247","doj":"2025-04-07","dob":"1995-06-11","leaves_2025":{"cl":"5","lat":"113"},"leaves_2026":{"el_open":12}},
{"id":1768048121381,"name":"Dr.Raghini Ramrao Navatke","desig":"Assistant Professor","dept":"Kayachikitsa","code":"AYKC04182","doj":"2025-04-23","dob":"","leaves_2025":{"lat":"45","mat":"20","cl":"6","ml":"0","od":"0","el_u":"0"},"leaves_2026":{}},
{"id":1767960539895,"name":"Dr.Madhuri Suryakant Biradar","desig":"Assistant Professor","dept":"Shalyatntra","code":"AYST02720","doj":"2025-05-17","dob":"1997-06-01","leaves_2025":{"cl":"7","el_u":"0","lat":"90"},"leaves_2026":{"el_open":13}},
{"id":1767957034325,"name":"Dr.Bharkade Jayshree Govindrao","desig":"Assistant Professor","dept":"Agadtantra evum VV","code":"AYAT00917","doj":"2025-05-23","dob":"1994-04-14","leaves_2025":{"lat":"86","cl":"8","ml":"2"},"leaves_2026":{"el_open":11}},
{"id":1768047235877,"name":"Dr.Ketki Rangnath Tarde","desig":"Assistant Professor","dept":"Sanskrit Samhita Siddhant","code":"AYSS02196","doj":"2025-05-24","dob":"","leaves_2025":{"cl":"4","ml":"72","od":"0","el_u":"0","lat":"17"},"leaves_2026":{}},
{"id":1767956778629,"name":"Dr.Shivani Tanajirao Patil","desig":"Assistant Professor","dept":"Sanskrit Samhita Siddhant","code":"AYSS02244","doj":"2025-06-04","dob":"1996-08-26","leaves_2025":{"cl":"6.5","lat":"69"},"leaves_2026":{"el_open":15}},
{"id":1768047609764,"name":"Dr.Swapnil Janardhan Biradar Patil","desig":"Assistant Professor","dept":"Kriya Sharir","code":"AYKS01398","doj":"2025-06-12","dob":"","leaves_2025":{"cl":"7","ml":"1","lat":"61","el_u":"0","od":"0"},"leaves_2026":{}},
{"id":1768370893500,"name":"Suraj Damodar Lavate","desig":"Assistant Professor","dept":"Shalakya tantra","code":"AYSK01446","doj":"2025-06-13","dob":"","leaves_2025":{},"leaves_2026":{}},
{"id":1767959185758,"name":"Dr.Biradar Mallikarjun Vishwanath","desig":"Assistant Professor","dept":"Agadtantra evum VV","code":"AYAT00926","doj":"2025-08-06","dob":"1966-09-01","leaves_2025":{"cl":"8","el_u":"8","lat":"79"},"leaves_2026":{"el_open":6}},
{"id":1768021175130,"name":"Dr.Priyanka Dnyanoba Devkatte","desig":"Assistant Professor","dept":"PTSR","code":"AYPS01975","doj":"2025-12-15","dob":"","leaves_2025":{"lat":"8","sl":"1"},"leaves_2026":{"el_open":15}},
{"id":1768370845124,"name":"Shivraj Shriram Vansure","desig":"Assistant Professor","dept":"Shalakya tantra","code":"AYSK01538","doj":"2025-12-15","dob":"","leaves_2025":{},"leaves_2026":{}},
{"id":1768370366020,"name":"Deepali Sanjay Kulkarni","desig":"Assistant Professor","dept":"","code":"","doj":"","dob":"","leaves_2025":{},"leaves_2026":{}},
{"id":1768021173515,"name":"Dr.Chetlure Shivkanta Laxman","desig":"Assistant Professor","dept":"Kayachikitsa","code":"","doj":"","dob":"","leaves_2025":{},"leaves_2026":{"el_open":15}},
{"id":1768370657534,"name":"Swapnil Janardhan Biradar Patil","desig":"Assistant Professor","dept":"Kriya Sharir","code":"","doj":"","dob":"","leaves_2025":{},"leaves_2026":{}}
];

window.onload=function(){document.getElementById('reportDate').valueAsDate=new Date();var d=localStorage.getItem('damch_v31');data=d?JSON.parse(d):JSON.parse(JSON.stringify(DD));var u=localStorage.getItem('damch_v31_u');users=u?JSON.parse(u):bldUsers();var a=localStorage.getItem('damch_v31_a');apps=a?JSON.parse(a):[];var s=sessionStorage.getItem('damch_ss');if(s){CU=JSON.parse(s);enterApp()}document.getElementById('loginPass').onkeypress=function(e){if(e.key==='Enter')doLogin()};document.getElementById('loginUser').onkeypress=function(e){if(e.key==='Enter')document.getElementById('loginPass').focus()}};
function bldUsers(){var u={'admin':{pw:'Admin@2025',role:'admin',fid:null}};data.forEach(function(r){var c=(r.code||'').trim();if(c.length>2)u[c]={pw:'damch@'+c,role:'faculty',fid:r.id}});localStorage.setItem('damch_v31_u',JSON.stringify(u));return u}
function togglePw(){var f=document.getElementById('loginPass');if(f.type==='password'){f.type='text';document.querySelector('.show-pw').innerHTML='<i class="fas fa-eye-slash"></i> Hide'}else{f.type='password';document.querySelector('.show-pw').innerHTML='<i class="fas fa-eye"></i> Show Password'}}
function doLogin(){var u=document.getElementById('loginUser').value.trim(),p=document.getElementById('loginPass').value,m=document.getElementById('loginMsg');if(!u||!p){m.textContent='Enter username & password';return}if(!users[u]){m.textContent='Invalid username';return}if(users[u].pw!==p){m.textContent='Wrong password';return}CU={username:u,role:users[u].role,fid:users[u].fid};sessionStorage.setItem('damch_ss',JSON.stringify(CU));m.textContent='';enterApp()}
function doLogout(){sessionStorage.removeItem('damch_ss');CU=null;document.getElementById('appContainer').style.display='none';document.getElementById('loginPage').style.display='flex';document.getElementById('loginUser').value='';document.getElementById('loginPass').value=''}
function enterApp(){document.getElementById('loginPage').style.display='none';document.getElementById('appContainer').style.display='flex';var isA=CU.role==='admin';var nm=isA?'Administrator':CU.username;document.getElementById('sbUserName').textContent=nm;document.getElementById('topUserBadge').innerHTML='<i class="fas fa-user"></i> '+nm;if(!isA){document.getElementById('adminLeaveCtrl').style.display='none';document.getElementById('adminSaveArea').style.display='none';document.getElementById('actColH').style.display='none'}else{document.getElementById('adminLeaveCtrl').style.display='';document.getElementById('adminSaveArea').style.display='';document.getElementById('actColH').style.display=''}showPage('dashboard',document.querySelector('.sb-menu li a'))}
function showPage(pg,el){document.querySelectorAll('.page-section').forEach(function(s){s.classList.remove('active')});var t=document.getElementById('pg_'+pg);if(t)t.classList.add('active');document.querySelectorAll('.sb-menu li a').forEach(function(a){a.classList.remove('active')});if(el)el.classList.add('active');var T={'dashboard':['<i class="fas fa-chart-pie"></i> Dashboard','Overview'],'leaveRecord':['<i class="fas fa-table"></i> Leave Record','Annual Data'],'applyLeave':['<i class="fas fa-paper-plane"></i> Apply Leave','Submit Request'],'applications':['<i class="fas fa-inbox"></i> Applications','Manage Requests'],'faculty':['<i class="fas fa-users"></i> Faculty','Directory'],'profile':['<i class="fas fa-user-cog"></i> Profile','My Info'],'reports':['<i class="fas fa-file-alt"></i> Reports','Print'],'settings':['<i class="fas fa-cog"></i> Settings','Config']};var ti=T[pg]||['',''];document.getElementById('pageTitle').innerHTML=ti[0];document.getElementById('pageSubtitle').textContent=ti[1];if(pg==='dashboard')renderDash();if(pg==='leaveRecord')renderLR();if(pg==='applyLeave')renderMyApps();if(pg==='applications')renderAllApps();if(pg==='faculty')renderFacList();if(pg==='profile')loadProf();if(pg==='settings')loadCreds()}
</script>
<script>
function sortD(){data.sort(function(a,b){var rA=DR[(a.desig||'').toUpperCase().trim()]||99,rB=DR[(b.desig||'').toUpperCase().trim()]||99;if(rA!==rB)return rA-rB;var dA=a.doj?new Date(a.doj):new Date('9999-12-31'),dB=b.doj?new Date(b.doj):new Date('9999-12-31');if(dA.getTime()!==dB.getTime())return dA-dB;return(a.name||'').localeCompare(b.name||'')})}
function cExp(d){if(!d)return'-';var j=new Date(d);if(isNaN(j))return'-';var n=new Date(),y=n.getFullYear()-j.getFullYear(),m=n.getMonth()-j.getMonth(),dy=n.getDate()-j.getDate();if(dy<0){m--;dy+=new Date(n.getFullYear(),n.getMonth(),0).getDate()}if(m<0){y--;m+=12}return y<0?'0':y+'Y '+m+'M '+dy+'D'}
function fD(s){if(!s)return'';var d=new Date(s);return isNaN(d)?'':String(d.getDate()).padStart(2,'0')+'/'+String(d.getMonth()+1).padStart(2,'0')+'/'+d.getFullYear()}
function cR(r,yr){var l=r['leaves_'+yr]||{},v=function(k){return parseFloat(l[k])||0};var cb=8-v('cl'),mb=10-v('ml'),rb=2-v('rh'),mtb=180-v('mat'),ptb=15-v('pat'),sb=15-v('sl'),sdb=120-v('sd');var eo=parseFloat(l.el_open)||0,et=eo+15,eb=et-v('el_u');var ld=Math.floor(v('lat')/6);var buf=cb+eb+mb+rb;if(buf<0)buf=0;var cov=0,ovf=0;if(ld<=buf)cov=ld;else{cov=buf;ovf=ld-buf}var tp=v('cl')+v('ml')+v('od')+v('el_u')+v('mat')+v('pat')+v('sl')+v('sd')+v('rh')+cov;var tu=v('lwp')+ovf;return{cb:cb,mb:mb,rb:rb,mtb:mtb,ptb:ptb,sb:sb,sdb:sdb,eo:eo,et:et,eb:eb,ld:ld,ovf:ovf,tp:tp,tu:tu,gt:tp+tu,lwd:v('lwp')+ovf,v:v}}

/* DASHBOARD */
function renderDash(){sortD();var tf=data.length,tp=0,pnd=0,tld=0;data.forEach(function(r){if((r.desig||'').toUpperCase()==='PROFESSOR')tp++;var res=cR(r,curYr);tld+=res.gt});apps.forEach(function(a){if(a.status==='Pending')pnd++});
document.getElementById('statsRow').innerHTML='<div class="stat-card"><div class="icon" style="background:linear-gradient(135deg,#1a237e,#3949ab)"><i class="fas fa-users"></i></div><div class="info"><h3>'+tf+'</h3><p>Total Faculty</p></div></div><div class="stat-card"><div class="icon" style="background:linear-gradient(135deg,#2e7d32,#43a047)"><i class="fas fa-user-tie"></i></div><div class="info"><h3>'+tp+'</h3><p>Professors</p></div></div><div class="stat-card"><div class="icon" style="background:linear-gradient(135deg,#e65100,#ff6d00)"><i class="fas fa-clock"></i></div><div class="info"><h3>'+pnd+'</h3><p>Pending Apps</p></div></div><div class="stat-card"><div class="icon" style="background:linear-gradient(135deg,#b71c1c,#d32f2f)"><i class="fas fa-calendar-minus"></i></div><div class="info"><h3>'+tld+'</h3><p>Leave Days ('+curYr+')</p></div></div>';
var dm={},dgm={},clr=['#1a237e','#b71c1c','#2e7d32','#e65100','#6a1b9a','#00838f','#f57f17','#4e342e','#37474f','#880e4f','#1b5e20','#ff6f00','#0d47a1','#4a148c','#263238'];data.forEach(function(r){var d=r.dept||'Other';dm[d]=(dm[d]||0)+1;var g=r.desig||'Other';dgm[g]=(dgm[g]||0)+1});
if(cDept)cDept.destroy();cDept=new Chart(document.getElementById('chartDept'),{type:'bar',data:{labels:Object.keys(dm),datasets:[{label:'Faculty',data:Object.values(dm),backgroundColor:clr}]},options:{responsive:true,plugins:{legend:{display:false}},scales:{x:{ticks:{font:{size:8},maxRotation:45}},y:{beginAtZero:true,ticks:{stepSize:1}}}}});
if(cDesig)cDesig.destroy();cDesig=new Chart(document.getElementById('chartDesig'),{type:'doughnut',data:{labels:Object.keys(dgm),datasets:[{data:Object.values(dgm),backgroundColor:clr}]},options:{responsive:true,plugins:{legend:{position:'bottom',labels:{font:{size:10}}}}}});
var sm={Pending:0,Approved:0,Rejected:0};apps.forEach(function(a){sm[a.status]=(sm[a.status]||0)+1});if(cStat)cStat.destroy();cStat=new Chart(document.getElementById('chartStatus'),{type:'pie',data:{labels:['Pending','Approved','Rejected'],datasets:[{data:[sm.Pending,sm.Approved,sm.Rejected],backgroundColor:['#ff9800','#4caf50','#f44336']}]},options:{responsive:true,plugins:{legend:{position:'bottom'}}}});
var ml=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],md=new Array(12).fill(0);apps.forEach(function(a){if(a.year==curYr&&a.status==='Approved'){var m=parseInt(a.fromDate.split('-')[1])-1;if(m>=0&&m<12)md[m]+=a.days||1}});if(cTrend)cTrend.destroy();cTrend=new Chart(document.getElementById('chartTrend'),{type:'line',data:{labels:ml,datasets:[{label:'Approved',data:md,borderColor:'#1a237e',backgroundColor:'rgba(26,35,126,.1)',fill:true,tension:.4}]},options:{responsive:true,scales:{y:{beginAtZero:true}},plugins:{legend:{display:false}}}});
var rc=apps.slice(-10).reverse(),rtb=document.querySelector('#recentAppsTable tbody');rtb.innerHTML='';rc.forEach(function(a){var f=data.find(function(r){return r.id===a.fid})||{name:'?'};var bg=a.status==='Pending'?'badge-pending':a.status==='Approved'?'badge-approved':'badge-rejected';rtb.innerHTML+='<tr><td>'+a.date+'</td><td>'+f.name+'</td><td>'+a.type+'</td><td>'+a.fromDate+'</td><td>'+a.toDate+'</td><td>'+a.days+'</td><td><span class="badge '+bg+'">'+a.status+'</span></td></tr>'})}

/* LEAVE RECORD - ADMIN CAN EDIT EVERYTHING */
function renderLR(){sortD();var tb=document.getElementById('lrBody');tb.innerHTML='';document.getElementById('lrTitle').textContent='Leave Record: '+curYr;var isA=CU&&CU.role==='admin';
data.forEach(function(r,i){var res=cR(r,curYr),l=r['leaves_'+curYr]||{},elo=l.el_open!==undefined?l.el_open:0,exp=cExp(r.doj);
var h='<td style="position:sticky;left:0;z-index:4;background:#fff;border-right:2px solid #333;font-weight:700;text-align:center">'+(i+1)+'</td>';
h+='<td class="name-cell">';
if(isA){
h+='<input type="text" value="'+(r.name||'')+'" onchange="uM('+r.id+',\'name\',this.value)" placeholder="Name" class="admin-input" style="font-weight:700;font-size:11px">';
h+='<input type="text" value="'+(r.desig||'')+'" onchange="uM('+r.id+',\'desig\',this.value)" placeholder="Designation" list="desigList" class="admin-input" style="font-size:10px">';
h+='<input type="text" value="'+(r.dept||'')+'" onchange="uM('+r.id+',\'dept\',this.value)" placeholder="Department" class="admin-input" style="font-size:10px">';
h+='<div style="display:flex;gap:3px;margin-top:2px"><div style="flex:1"><span style="font-size:8px;color:#555;font-weight:700">Code</span><input type="text" value="'+(r.code||'')+'" onchange="uM('+r.id+',\'code\',this.value)" class="admin-input" style="font-size:9px"></div>';
h+='<div style="flex:1"><span style="font-size:8px;color:#555;font-weight:700">DOJ</span><input type="date" value="'+(r.doj||'')+'" onchange="uM('+r.id+',\'doj\',this.value)" class="admin-input" style="font-size:9px"></div>';
h+='<div style="flex:1"><span style="font-size:8px;color:#555;font-weight:700">DOB</span><input type="date" value="'+(r.dob||'')+'" onchange="uM('+r.id+',\'dob\',this.value)" class="admin-input" style="font-size:9px"></div></div>';
}else{
h+='<div style="font-weight:700;font-size:11px">'+r.name+'</div><div style="font-size:9px;color:#666">'+(r.desig||'')+' | '+(r.dept||'')+'</div><div style="font-size:8px;color:#888">Code: '+(r.code||'-')+' | DOJ: '+fD(r.doj)+'</div>';}
h+='<div class="exp-tag">'+exp+'</div></td>';
if(isA){h+='<td><input type="number" value="'+(l.cl||'')+'" onchange="uL('+r.id+',\'cl\',this.value)"></td><td class="bal">'+res.cb+'</td><td><input type="number" value="'+(l.ml||'')+'" onchange="uL('+r.id+',\'ml\',this.value)"></td><td class="bal">'+res.mb+'</td><td><input type="number" value="'+(l.od||'')+'" onchange="uL('+r.id+',\'od\',this.value)"></td><td><input type="number" value="'+elo+'" onchange="uL('+r.id+',\'el_open\',this.value)" style="background:#e3f2fd"></td><td class="bal">15</td><td class="bal">'+res.et+'</td><td><input type="number" value="'+(l.el_u||'')+'" onchange="uL('+r.id+',\'el_u\',this.value)"></td><td class="bal" style="background:#bbdefb">'+res.eb+'</td><td><input type="number" value="'+(l.lat||'')+'" onchange="uL('+r.id+',\'lat\',this.value)"></td><td class="bal-neg">'+res.ld+'</td><td><input type="number" value="'+(l.mat||'')+'" onchange="uL('+r.id+',\'mat\',this.value)"></td><td class="bal">'+res.mtb+'</td><td><input type="number" value="'+(l.pat||'')+'" onchange="uL('+r.id+',\'pat\',this.value)"></td><td class="bal">'+res.ptb+'</td><td><input type="number" value="'+(l.sl||'')+'" onchange="uL('+r.id+',\'sl\',this.value)"></td><td class="bal">'+res.sb+'</td><td><input type="number" value="'+(l.sd||'')+'" onchange="uL('+r.id+',\'sd\',this.value)"></td><td class="bal">'+res.sdb+'</td><td><input type="number" value="'+(l.rh||'')+'" onchange="uL('+r.id+',\'rh\',this.value)"></td><td class="bal">'+res.rb+'</td>';}
else{h+='<td class="bal">'+(parseFloat(l.cl)||0)+'</td><td class="bal">'+res.cb+'</td><td class="bal">'+(parseFloat(l.ml)||0)+'</td><td class="bal">'+res.mb+'</td><td class="bal">'+(parseFloat(l.od)||0)+'</td><td class="bal">'+elo+'</td><td class="bal">15</td><td class="bal">'+res.et+'</td><td class="bal">'+(parseFloat(l.el_u)||0)+'</td><td class="bal" style="background:#bbdefb">'+res.eb+'</td><td class="bal">'+(parseFloat(l.lat)||0)+'</td><td class="bal-neg">'+res.ld+'</td><td class="bal">'+(parseFloat(l.mat)||0)+'</td><td class="bal">'+res.mtb+'</td><td class="bal">'+(parseFloat(l.pat)||0)+'</td><td class="bal">'+res.ptb+'</td><td class="bal">'+(parseFloat(l.sl)||0)+'</td><td class="bal">'+res.sb+'</td><td class="bal">'+(parseFloat(l.sd)||0)+'</td><td class="bal">'+res.sdb+'</td><td class="bal">'+(parseFloat(l.rh)||0)+'</td><td class="bal">'+res.rb+'</td>';}
h+='<td class="tot-paid">'+res.tp+'</td>';if(isA){h+='<td><input type="number" value="'+(l.lwp||'')+'" onchange="uL('+r.id+',\'lwp\',this.value)">'+(res.ovf>0?'<div style="font-size:7px;color:red;font-weight:700">(+'+res.ovf+')</div>':'')+'</td>';}else{h+='<td class="bal">'+res.lwd+'</td>'}
h+='<td class="tot-unpaid">'+res.tu+'</td><td class="grand">'+res.gt+'</td>';if(isA)h+='<td><button class="btn btn-sm btn-danger" onclick="delRow('+r.id+')"><i class="fas fa-trash"></i></button></td>';
var tr=document.createElement('tr');tr.innerHTML=h;tb.appendChild(tr)})}

/* APPLICATIONS */
function submitApp(){if(!CU||CU.role==='admin'){alert('Only faculty can apply');return}var ty=document.getElementById('appType').value,dy=parseInt(document.getElementById('appDays').value)||1,fr=document.getElementById('appFrom').value,to=document.getElementById('appTo').value,rs=document.getElementById('appReason').value;if(!fr||!to||!rs){alert('Fill all fields');return}apps.push({id:Date.now(),fid:CU.fid,username:CU.username,type:ty,days:dy,fromDate:fr,toDate:to,reason:rs,status:'Pending',date:new Date().toISOString().slice(0,10),year:fr.split('-')[0]});localStorage.setItem('damch_v31_a',JSON.stringify(apps));alert('Submitted!');document.getElementById('appReason').value='';renderMyApps()}
function renderMyApps(){var tb=document.querySelector('#myAppsTable tbody');tb.innerHTML='';apps.filter(function(a){return a.fid===CU.fid}).reverse().forEach(function(a){var bg=a.status==='Pending'?'badge-pending':a.status==='Approved'?'badge-approved':'badge-rejected';tb.innerHTML+='<tr><td>'+a.date+'</td><td>'+a.type+'</td><td>'+a.fromDate+'</td><td>'+a.toDate+'</td><td>'+a.days+'</td><td>'+a.reason+'</td><td><span class="badge '+bg+'">'+a.status+'</span></td></tr>'})}
function renderAllApps(){var tb=document.querySelector('#allAppsTable tbody');tb.innerHTML='';var ls=appFlt==='all'?apps:apps.filter(function(a){return a.status===appFlt});var pc=apps.filter(function(a){return a.status==='Pending'}).length;document.getElementById('pendCnt').textContent=pc>0?pc+' Pending':'';ls.slice().reverse().forEach(function(a){var f=data.find(function(r){return r.id===a.fid})||{name:'?',code:'?',dept:'?'};var bg=a.status==='Pending'?'badge-pending':a.status==='Approved'?'badge-approved':'badge-rejected';var act=a.status==='Pending'?'<button class="btn btn-sm btn-success" onclick="actApp('+a.id+',\'Approved\')"><i class="fas fa-check"></i></button> <button class="btn btn-sm btn-danger" onclick="actApp('+a.id+',\'Rejected\')"><i class="fas fa-times"></i></button>':'Done';tb.innerHTML+='<tr><td>'+a.date+'</td><td>'+f.name+'</td><td>'+f.code+'</td><td>'+f.dept+'</td><td>'+a.type+'</td><td>'+a.fromDate+'</td><td>'+a.toDate+'</td><td>'+a.days+'</td><td>'+a.reason+'</td><td><span class="badge '+bg+'">'+a.status+'</span></td><td>'+act+'</td></tr>'})}
function filterApps(f){appFlt=f;renderAllApps()}
function actApp(id,st){var a=apps.find(function(x){return x.id===id});if(a){a.status=st;localStorage.setItem('damch_v31_a',JSON.stringify(apps));renderAllApps();renderDash()}}
</script>
<script>
/* FACULTY LIST */
function renderFacList(){sortD();var tb=document.querySelector('#facTable tbody');tb.innerHTML='';var q=(document.getElementById('facSrch').value||'').toLowerCase();data.forEach(function(r,i){if(q&&(r.name||'').toLowerCase().indexOf(q)===-1&&(r.code||'').toLowerCase().indexOf(q)===-1&&(r.dept||'').toLowerCase().indexOf(q)===-1)return;var db=r.desig==='Principal'?'badge-principal':r.desig==='Professor'?'badge-professor':(r.desig||'').indexOf('Associate')>-1?'badge-assoc':'badge-asst';tb.innerHTML+='<tr><td>'+(i+1)+'</td><td><b>'+r.name+'</b></td><td><span class="badge '+db+'">'+r.desig+'</span></td><td>'+r.dept+'</td><td>'+r.code+'</td><td>'+fD(r.doj)+'</td><td>'+cExp(r.doj)+'</td></tr>'})}

/* PROFILE */
function autoTab(e,n){if(e.value.length>=parseInt(e.maxLength))document.getElementById(n).focus()}
function loadProf(){if(CU.role==='admin'){document.getElementById('pName').value='Administrator';document.getElementById('pCode').value='admin';document.getElementById('pDesig').value='Admin';document.getElementById('pDept').value='All';return}var r=data.find(function(x){return x.id===CU.fid});if(!r)return;document.getElementById('pName').value=r.name||'';document.getElementById('pCode').value=r.code||'';document.getElementById('pDesig').value=r.desig||'';document.getElementById('pDept').value=r.dept||'';if(r.doj){var d=new Date(r.doj);if(!isNaN(d)){document.getElementById('pDojD').value=String(d.getDate()).padStart(2,'0');document.getElementById('pDojM').value=String(d.getMonth()+1).padStart(2,'0');document.getElementById('pDojY').value=d.getFullYear()}}else{document.getElementById('pDojD').value='';document.getElementById('pDojM').value='';document.getElementById('pDojY').value=''}if(r.dob){var b=new Date(r.dob);if(!isNaN(b)){document.getElementById('pDobD').value=String(b.getDate()).padStart(2,'0');document.getElementById('pDobM').value=String(b.getMonth()+1).padStart(2,'0');document.getElementById('pDobY').value=b.getFullYear()}}else{document.getElementById('pDobD').value='';document.getElementById('pDobM').value='';document.getElementById('pDobY').value=''}document.getElementById('pNewPw').value=''}
function saveProf(){if(CU.role==='admin'){var np=document.getElementById('pNewPw').value;if(np&&np.length>=4){users['admin'].pw=np;localStorage.setItem('damch_v31_u',JSON.stringify(users));alert('Admin password changed!')}return}var r=data.find(function(x){return x.id===CU.fid});if(!r)return;var dd=document.getElementById('pDojD').value.trim(),mm=document.getElementById('pDojM').value.trim(),yy=document.getElementById('pDojY').value.trim();if(dd&&mm&&yy)r.doj=yy+'-'+mm.padStart(2,'0')+'-'+dd.padStart(2,'0');var d2=document.getElementById('pDobD').value.trim(),m2=document.getElementById('pDobM').value.trim(),y2=document.getElementById('pDobY').value.trim();if(d2&&m2&&y2)r.dob=y2+'-'+m2.padStart(2,'0')+'-'+d2.padStart(2,'0');var np=document.getElementById('pNewPw').value;if(np&&np.length>=4){users[CU.username].pw=np;localStorage.setItem('damch_v31_u',JSON.stringify(users))}saveAll();alert('Saved!')}

/* SETTINGS - CREDENTIALS */
function loadCreds(){var s=document.getElementById('mngSel');if(!s)return;s.innerHTML='<option value="">-- Select --</option><option value="admin">Admin (admin)</option>';data.forEach(function(r){var c=(r.code||'').trim();if(c.length>2)s.innerHTML+='<option value="'+c+'">'+r.name+' ('+c+')</option>'})}
function loadCred(){var u=document.getElementById('mngSel').value;document.getElementById('mngUser').value=u||'';document.getElementById('mngNewPw').value='';document.getElementById('mngMsg').textContent='';if(u&&users[u])document.getElementById('mngCurPw').value=users[u].pw;else document.getElementById('mngCurPw').value=''}
function saveCred(){var u=document.getElementById('mngSel').value,np=document.getElementById('mngNewPw').value.trim(),m=document.getElementById('mngMsg');if(!u){m.textContent='Select faculty!';m.style.color='red';return}if(!np||np.length<4){m.textContent='Min 4 characters!';m.style.color='red';return}if(users[u]){users[u].pw=np;localStorage.setItem('damch_v31_u',JSON.stringify(users));m.textContent='Password updated! New: '+np;m.style.color='green';document.getElementById('mngCurPw').value=np}else{m.textContent='User not found!';m.style.color='red'}}

/* REPORTS */
function rptAllDetail(){rptDetail(null)}function rptDeptDetail(){var d=prompt('Enter Department:');if(d)rptDetail(d.trim())}function rptDeptSummary(){var d=prompt('Enter Department:');if(d)rptMaster(d.trim())}
function rptDetail(dept){var pa=document.getElementById('printArea');var h='<div style="font-family:Poppins,sans-serif;font-size:10px"><div style="text-align:center;border-bottom:2px solid #000;padding-bottom:8px;margin-bottom:10px"><h3>Bal Bhagwan Shikshan Prasarak Mandal Ahmedpur\'s</h3><h2 style="color:#b71c1c">DHANWANTARI AYURVED MEDICAL COLLEGE & HOSPITAL UDGIR</h2><h4>Detailed Leave Report - '+curYr+'</h4></div>';data.forEach(function(r){if(dept&&(r.dept||'').toUpperCase()!==dept.toUpperCase())return;var res=cR(r,curYr),v=function(k){return parseFloat((r['leaves_'+curYr]||{})[k])||0};h+='<div style="border:1px solid #000;padding:6px;margin-bottom:8px;page-break-inside:avoid"><div style="display:flex;justify-content:space-between;border-bottom:1px solid #000;padding-bottom:3px;margin-bottom:5px"><b>'+r.name+'</b><span>'+curYr+'</span></div><div style="display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:3px;font-size:9px;margin-bottom:5px"><div><b>Desig:</b> '+r.desig+'</div><div><b>Dept:</b> '+r.dept+'</div><div><b>Code:</b> '+r.code+'</div><div><b>Exp:</b> '+cExp(r.doj)+'</div></div><table style="width:100%;border-collapse:collapse;font-size:9px"><tr style="background:#ddd"><th style="border:1px solid #000;padding:2px">Type</th><th style="border:1px solid #000">Limit</th><th style="border:1px solid #000">Used</th><th style="border:1px solid #000">Bal</th><th style="border:1px solid #000">Type</th><th style="border:1px solid #000">Limit</th><th style="border:1px solid #000">Used</th><th style="border:1px solid #000">Bal</th></tr><tr><td style="border:1px solid #000">CL</td><td style="border:1px solid #000">8</td><td style="border:1px solid #000">'+v('cl')+'</td><td style="border:1px solid #000">'+res.cb+'</td><td style="border:1px solid #000">ML</td><td style="border:1px solid #000">10</td><td style="border:1px solid #000">'+v('ml')+'</td><td style="border:1px solid #000">'+res.mb+'</td></tr><tr><td style="border:1px solid #000">EL</td><td style="border:1px solid #000">'+res.et+'</td><td style="border:1px solid #000">'+v('el_u')+'</td><td style="border:1px solid #000">'+res.eb+'</td><td style="border:1px solid #000">SL</td><td style="border:1px solid #000">15</td><td style="border:1px solid #000">'+v('sl')+'</td><td style="border:1px solid #000">'+res.sb+'</td></tr></table><div style="text-align:right;margin-top:3px;font-weight:700;font-size:10px">Late:'+v('lat')+' Pen:'+res.ld+' | PAID:'+res.tp+' UNPAID:'+res.tu+' | <span style="background:yellow;padding:0 4px">TOTAL:'+res.gt+'</span></div></div>'});h+='<div style="text-align:center;font-size:8px;border-top:1px solid #999;padding-top:4px;margin-top:10px">Designed & Developed by Dr. Jadhav V.R. | 9518356305</div></div>';pa.innerHTML=h;pa.style.display='block';window.print();pa.style.display='none'}
function rptMaster(dept){var pa=document.getElementById('printArea');var h='<div style="font-family:Poppins,sans-serif;font-size:9px"><div style="text-align:center;border-bottom:2px solid #000;padding-bottom:8px;margin-bottom:10px"><h3>Bal Bhagwan Shikshan Prasarak Mandal Ahmedpur\'s</h3><h2 style="color:#b71c1c">DHANWANTARI AYURVED MEDICAL COLLEGE & HOSPITAL</h2><h4>Master Summary - '+curYr+(dept?' | '+dept:'')+'</h4></div>';var g={};data.forEach(function(r){var d=(r.dept||'Other').toUpperCase();if(dept&&d!==dept.toUpperCase())return;if(!g[d])g[d]=[];g[d].push(r)});Object.keys(g).sort().forEach(function(d){h+='<div style="background:#eee;font-weight:700;padding:3px;border:1px solid #000;margin-top:5px">'+d+'</div><table style="width:100%;border-collapse:collapse;font-size:8px"><tr style="background:#ddd"><th style="border:1px solid #000">Sr</th><th style="border:1px solid #000">Name</th><th style="border:1px solid #000">CL</th><th style="border:1px solid #000">ML</th><th style="border:1px solid #000">EL</th><th style="border:1px solid #000">OD</th><th style="border:1px solid #000">Late</th><th style="border:1px solid #000">LWP</th><th style="border:1px solid #000">Total</th></tr>';g[d].forEach(function(r,i){var res=cR(r,curYr),v=function(k){return parseFloat((r['leaves_'+curYr]||{})[k])||0};h+='<tr><td style="border:1px solid #000">'+(i+1)+'</td><td style="border:1px solid #000;text-align:left"><b>'+r.name+'</b></td><td style="border:1px solid #000">'+res.cb+'</td><td style="border:1px solid #000">'+res.mb+'</td><td style="border:1px solid #000">'+res.eb+'</td><td style="border:1px solid #000">'+v('od')+'</td><td style="border:1px solid #000">'+res.ld+'</td><td style="border:1px solid #000">'+res.lwd+'</td><td style="border:1px solid #000"><b>'+res.gt+'</b></td></tr>'});h+='</table>'});h+='<div style="text-align:center;font-size:8px;border-top:1px solid #999;padding-top:4px;margin-top:10px">Designed & Developed by Dr. Jadhav V.R. | 9518356305</div></div>';pa.innerHTML=h;pa.style.display='block';window.print();pa.style.display='none'}

/* UTILS */
function uL(id,k,v){var r=data.find(function(x){return x.id===id});if(!r['leaves_'+curYr])r['leaves_'+curYr]={};r['leaves_'+curYr][k]=v;saveAll();renderLR()}
function uM(id,k,v){var r=data.find(function(x){return x.id===id});if(!r)return;if(k==='code'){var ok=Object.keys(users).find(function(u){return users[u].fid===id&&u!=='admin'});if(ok)delete users[ok];var nc=(v||'').trim();if(nc.length>2)users[nc]={pw:'damch@'+nc,role:'faculty',fid:id};localStorage.setItem('damch_v31_u',JSON.stringify(users))}r[k]=v;saveAll();if(k==='desig'||k==='doj'||k==='name')renderLR()}
function addRow(){data.push({id:Date.now(),name:'',desig:'',dept:'',code:'',doj:'',dob:'',leaves_2025:{},leaves_2026:{}});saveAll();renderLR()}
function delRow(id){if(confirm('Delete?')){data=data.filter(function(r){return r.id!==id});var uk=Object.keys(users).find(function(u){return users[u].fid===id});if(uk){delete users[uk];localStorage.setItem('damch_v31_u',JSON.stringify(users))}saveAll();renderLR()}}
function swYear(y){curYr=y;document.getElementById('btnYr25').className=y==='2025'?'btn btn-primary':'btn';document.getElementById('btnYr25').style.cssText=y==='2025'?'':'background:#555;color:#fff';document.getElementById('btnYr26').className=y==='2026'?'btn btn-primary':'btn';document.getElementById('btnYr26').style.cssText=y==='2026'?'':'background:#555;color:#fff';renderLR()}
function calcCarryFwd(){if(!confirm('Calculate 2026 EL from 2025?'))return;data.forEach(function(r){var res=cR(r,'2025');var p=res.ld,o=res.cb+res.mb+res.rb,pe=0;if(p>o)pe=p-o;var el=res.eb-pe;if(el<0)el=0;if(!r.leaves_2026)r.leaves_2026={};r.leaves_2026.el_open=el});alert('Done!');swYear('2026');saveAll()}
function searchFac(){var n=prompt('Name:');if(!n)return;var f=data.find(function(r){return(r.name||'').toLowerCase().indexOf(n.toLowerCase())>-1});if(f)alert(f.name+'\n'+f.desig+' | '+f.dept+'\nCode: '+f.code+'\nDOJ: '+fD(f.doj)+'\nExp: '+cExp(f.doj));else alert('Not found')}
function saveAll(){localStorage.setItem('damch_v31',JSON.stringify(data));localStorage.setItem('damch_v31_a',JSON.stringify(apps))}
function downloadJSON(){var b=new Blob([JSON.stringify({data:data,apps:apps},null,2)],{type:'application/json'});var a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='DAMCH_Backup_'+new Date().toISOString().slice(0,10)+'.json';a.click()}
function expCSV(){var csv='Sr,Name,Desig,Dept,Code,DOJ,Exp,CL,ML,EL,OD,Late,LWP,Total\n';data.forEach(function(r,i){var res=cR(r,curYr),v=function(k){return parseFloat((r['leaves_'+curYr]||{})[k])||0};csv+=(i+1)+',"'+r.name+'","'+r.desig+'","'+(r.dept||'')+'","'+(r.code||'')+'","'+fD(r.doj)+'","'+cExp(r.doj)+'",'+res.cb+','+res.mb+','+res.eb+','+v('od')+','+res.ld+','+res.lwd+','+res.gt+'\n'});var b=new Blob([csv],{type:'text/csv'});var a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='DAMCH_'+curYr+'.csv';a.click()}
function restoreJSON(e){var r=new FileReader();r.onload=function(ev){try{var d=JSON.parse(ev.target.result);if(d.data)data=d.data;else data=d;if(d.apps)apps=d.apps;bldUsers();saveAll();alert('Restored!');location.reload()}catch(err){alert('Invalid file')}};r.readAsText(e.target.files[0])}
function upLogo(e){var r=new FileReader();r.onload=function(ev){localStorage.setItem('damch_logo',ev.target.result);location.reload()};r.readAsDataURL(e.target.files[0])}
function resetAll(){if(confirm('Reset ALL?')){localStorage.removeItem('damch_v31');localStorage.removeItem('damch_v31_u');localStorage.removeItem('damch_v31_a');location.reload()}}
</script>
</body>
</html>
